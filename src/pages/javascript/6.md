---
title: "JavaScript_6"
description: 'YouTubeのAPIを使ってみよう。'
category: 'javascript'
date: "2020-06-01"
tags: ['JavaScript','Youtube','API']
author: '河口 英生'
slug: 'post-6'
featuredImage: speed_fast_rabbit.png
---
<div class="post-section">
<h3 class="title is-5" >小テスト</h3>

[JavaScript演習小テスト⑤](https://forms.gle/i6zbp7YJt6e8YeXBA)

HTML、配列、オブジェクト、JSONのそれぞれの値を取得してみよう。  
前回と取得の仕方は変わりませんが、最後の問題は取得した値をHTMLに表示させています。
</div>

<div class="post-section">
<h3 class="title is-5" >課題</h3>

【宿題】次回、天気APIで天気を取得して、表示させるコードを作成してくる。  
表示の仕方は、各自、調整・工夫をしてくること。
</div>

<div class="post-section">
<h3 class="title is-5" >YouTube API</h3>
<h4 class="title is-6" >YouTubeのAPIを使ってみよう。</h4>

YouTubeのAPIには、２種類あります。  
動画プレイヤーを操作するためのYouTube Player APIと  
YouTube内のデータを取得して利用するYouTube Data APIです。

<h4 class="title is-6" >YouTube Player API</h4>

[IFrame Player API](https://developers.google.com/youtube/iframe_api_reference?hl=ja)のサンプルを参考に、実際に操作してみましょう。

```javascript
<!DOCTYPE html>
<html>
  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <!-- 1. ここの<div>タグがYoutubeの<iframe>に置き換わる。 -->
    <div id="player"></div>

    <script>
      // 2. This code loads the IFrame Player API code asynchronously.
      // 2. 変数tagにscriptタグを作って入れる。Element=要素、Attrubute=属性
      let tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      let firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      //3. APIのコードを読み込んでから、この関数を<iframe>内に影響させる。
      let player;
     
      function onYouTubeIframeAPIReady() {
        //最初のplayerは、変数。後ろのplayerは、<div>のid
        player = new YT.Player('player', {
          height: '360',
          width: '640',
          videoId: 'M7lc1UVf-VE',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      //4. このAPIは、video playderが準備でしたら、この関数を呼び出します。
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      /* 5. video playerのステート（状態）が変更されたら、この関数を呼び出す。
            動画を再生するときの設定は、state=1にしておきます。
            プレイヤーは、6000ミリ秒後に終了します。 */
      let done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
          setTimeout(stopVideo, 6000);
          done = true;
        }
      }
      //停止関数
      function stopVideo() {
        player.stopVideo();
      }
    </script>
  </body>
</html>

```

<h4 class="title is-6" >video IDで動画を変更</h4>

YouTubeのvideo IDを調べて表示される動画を変更してみよう。[YOASOBI「あの夢をなぞって」 Official Music Video](https://www.youtube.com/watch?v=sAuEeM_6zpk)のURLのパラメータ?v=sAuEeM_6zpkの「sAuEeM_6zpk」がvideo IDになります。

```javascript

// 3. This function creates an <iframe> (and YouTube player)
//    after the API code downloads.
//3. APIのコードを読み込んでから、この関数を<iframe>内に影響させる。
let player;

//①video IDを変数 youtubeIdに代入
let youtubeId = sAuEeM_6zpk //YOASOBI「あの夢をなぞって」
function onYouTubeIframeAPIReady() {
//最初のplayerは、変数。後ろのplayerは、<div>のid
player = new YT.Player('player', {
    height: '360',
    width: '640',
    videoId: youtubeId, //②videoIdをyoutubeIdに変更
    events: {
    'onReady': onPlayerReady,
    'onStateChange': onPlayerStateChange
    }
});
}
```

<div class="post-section">
<h3 class="title is-5" >動画プレイヤー外からの操作</h3>

- 再生
- 停止
- 一時停止（ポーズ）
- 1分前へ・1分先へ
- 音量アップ・音量ダウン
- ミュート
- 再生動画の切り替え

<h4 class="title is-6" >再生</h4>

htmlで再生ボタンを作成して、その再生ボタンで操作します。

```javascript
<div id="player"></div>
<!-- 動画が表示されている<div>の下に追加 -->
<nav>
    <ul>
        <li id="doplay">再生</li>
    </ul>
</nav>
```
jQueryを利用する場合は、CDNで読み込んでおきましょう。
```javascript
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
```

[IFrame Player API](https://developers.google.com/youtube/iframe_api_reference?hl=ja)内に色々とプロパティの説明があります。[再生の制御とプレーヤーの設定](https://developers.google.com/youtube/iframe_api_reference?hl=ja#Playback_controls)に動画の再生メソッドがあります。
voidは１つの式を取って、常にundefinedを返す演算子です。

```javascript
//再生イベント
let doplayBtn = document.querySelector('#doplay');
doplayBtn.addEventListener('click', function() {
    player.playVideo();
})
```

既にplayer.stopVideo();を使った関数stopVideo()があるので、同じように関数として定義します。

```javascript
//再生関数
function playTheVideo(){
    player.playVideo();
}
//再生イベント
let doplayBtn = document.querySelector('#doplay');
doplayBtn.addEventListener('click', function() {
    playTheVideo(); //関数名に変更
})
//jQuery 再生イベント
$('#doplay').on('click',function(){
    playTheVideo();
})
```

<h4 class="title is-6" >停止</h4>

htmlで停止ボタンを作成し、既にあるstopVideo関数を使ったイベントを作成します。

```javascript
<li id="dostop">停止</li>
```
```javascript
//停止イベント
let dostopBtn = document.getElementById('dostop');
dostopBtn.addEventListener('click', function() {
    stopVideo();
})
//jQuery 停止イベント
$('#dostop').on('click',function(){
    stopVideo();
})
```

<h4 class="title is-6" >一時停止（ポーズ）</h4>

停止してしまうと、再生すると最初からになってしまうので、一時停止ボタンを作成します。

```javascript
<li id="dopause">一時停止</li>
```
```javascript
 //一時停止関数
function pauseTheVideo() {
    player.pauseVideo();
};
//一時停止イベント
let dopauseBtn = document.getElementById('dopause');
dopauseBtn.addEventListener('click', function() {
    pauseTheVideo();
})
//jQuery 停止イベント
$('#dopause').on('click',function(){
    pauseTheVideo();
})
```

<h4 class="title is-6" >その他の操作</h4>

では、上記と同じように残りの3つの操作ボタンを作成してみましょう。

- ミュート
- 1分前へ・1分先へ
- 音量アップ・音量ダウン

YouTubeの動画を操作するメソッドは、[再生の制御とプレーヤーの設定](https://developers.google.com/youtube/iframe_api_reference?hl=ja#Playback_controls)に準備されています。

</div>